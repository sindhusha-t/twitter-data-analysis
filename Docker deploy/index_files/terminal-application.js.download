var TerminalViewLayout=function(views){var startedSessionTime=new Date;var that=this;var copied_code=[];var environment_data=[];var terminals=[];var socket;that.is_ready=false;that.need_to_execute_steps=[];that.code_queue=[];var environmentWarningTimer;var environmentTooLongWarningTimer;var environmentTooLongErrorTimer;var environmentTooLongerErrorTimer;var clearErrorTimers=function(){clearTimeout(environmentTooLongWarningTimer);clearTimeout(environmentTooLongErrorTimer);clearTimeout(environmentTooLongerErrorTimer)};var sendMetric=function(type){$.ajax({data:"scenario="+course.course.pathwayId+"/"+course.course.id+"&metric=client_connection_"+type+"_min",url:"/metrics/custom",type:"POST"})};this.init=function(opts){var bot=/bot|headless|googlebot|bingpreview|crawler|spider|robot|crawling/i.test(navigator.userAgent);if(bot===true){console.log(navigator.userAgent);trackJs.track("[WARN] Bot");var t=$("#terminal");t.text("Your user-agent includes blocked keywords (bot|googlebot|bingpreview|crawler|spider|robot|crawling). ");return}var alreadyOpenSession=getCookie("katacoda/environment-open");if(!alreadyOpenSession){var alreadyOpenSessionDataToPersist={dockerimage:window.course.course.backend.dockerimage,course:course.course.pathwayId,id:course.course.id,opened:new Date};setCookie("katacoda/environment-open",JSON.stringify(alreadyOpenSessionDataToPersist));$(window).on("beforeunload",function(){eraseCookie("katacoda/environment-open")})}else{trackJs.track("[WARN] Multiple Tabs");var t=$("#terminal");var alreadyOpenSessionData=JSON.parse(alreadyOpenSession)}if(window.course.course.backend.dockerimage===undefined){var t=$("#terminal");t.text("No environment defined for scenario");return}environmentTooLongWarningTimer=setTimeout(function(){if(window.trackJs){trackJs.track("Environment Start: Over 1 minute")}sendMetric("one")},6e4);environmentTooLongErrorTimer=setTimeout(function(){if(window.trackJs){trackJs.track("Environment Start: Over 3 minute")}sendMetric("three")},18e4);environmentTooLongerErrorTimer=setTimeout(function(){if(window.trackJs){trackJs.track("Environment Start: Over 5 minute")}sendMetric("five")},3e5);$("nav #help-link").removeClass("hidden");var modal=$(".modal-trigger");if(modal&&modal.leanModal)modal.leanModal();environmentWarningTimer=setTimeout(show_environment_waiting,600);if(views===undefined||views.tabview===undefined){var tabbedView=new TabBarView;tabbedView.init()}var embedded="";if(opts&&opts.embedded===true||app&&app.embedded===true){embedded+="&embedded=true"}if(opts&&opts.host===true){embedded+="&host="+opts.host}var query="dockerimage="+window.course.course.backend.dockerimage+"&course="+course.course.pathwayId+"&id="+course.course.id+embedded;if(window.originalPathwayId!==course.course.pathwayId)query+="&originalPathwayId="+window.originalPathwayId;if(window.location.pathname.indexOf("training")>=0)query+="&training=true";query+="&_csrf="+window._csrf;var supported;var redirected;if(document.cookie!==""){supported=getCookieValue("websocketssupported");redirected=getCookieValue("websocketssupportedredir")}else{console.log("Cookies are disabled...");supported=true;redirected=true}if(supported==="false"){console.log("Websockets not supported...");socket=io.connect(getWSURL(window.course.course.backend.dockerimage),{transports:["websocket"],timeout:120*1e3,reconnection:false,query:query})}else{socket=io.connect(getWSURL(window.course.course.backend.dockerimage),{transports:["websocket"],timeout:120*1e3,reconnection:false,query:query})}socket.on("connect_error",function(err){eraseCookie("katacoda/environment-open");if(supported!=="false"){console.log("Websocket failed, falling back to Polling",err);document.cookie="websocketssupported=false";if(window.trackJs)trackJs.track("[WARN] Websockets Not Supported")}hide_environment_waiting();hide_content();console.log(err.toString());writeErrorMessageToAllTerminals("Sorry, we encountered a problem. Support has been alerted.");writeErrorMessageToAllTerminals("This is potentially due to a HTTP Proxy blocking Websockets.");writeErrorMessageToAllTerminals("Websocket Error - Connection Failed. Reload the page to try again.");trackJs.track("Websocket Connection Failed - "+err.toString());if(window.course&&window.course.is_dirty)window.course.is_dirty(false);clearErrorTimers()});socket.on("no-environments-available",function(data){eraseCookie("katacoda/environment-open");hide_environment_waiting();writeErrorMessageToAllTerminals(data);if(window.course&&window.course.is_dirty)window.course.is_dirty(false);trackJs.track("No Environments Available");clearErrorTimers()});socket.on("cookie-error",function(data){eraseCookie("katacoda/environment-open");hide_environment_waiting();hide_content();writeErrorMessageToAllTerminals("Problem accessing cookies. Are 3rd party cookies enabled?");trackJs.track("Cookie Error - WebSocket: "+navigator.cookieEnabled);if(window.course&&window.course.is_dirty)window.course.is_dirty(false);clearErrorTimers()});socket.on("connect_timeout",function(err){eraseCookie("katacoda/environment-open");hide_environment_waiting();hide_content();console.log(err.toString());writeErrorMessageToAllTerminals("Sorry, we encountered a problem. Support has been alerted.");writeErrorMessageToAllTerminals("This is potentially due to a connection timeout. Do you have a Proxy/Firewall blocking WebSockets?");writeErrorMessageToAllTerminals("Websocket Error - Connection Timeout.");trackJs.track("Websocket Connection Timeout - "+err.toString());if(window.course&&window.course.is_dirty)window.course.is_dirty(false);clearErrorTimers()});socket.on("blocked",function(data){validReasonToDisconnect=true;eraseCookie("katacoda/environment-open");hide_environment_waiting();hide_content();if(data.message){writeErrorMessageToAllTerminals(data.message);alert(data.message)}else if(data.redirect){window.location=data.redirect}if(window.trackJs)trackJs.track("[WARN] Blocked User",data.message);clearErrorTimers()});var hide_content=function(){$(".step").addClass("hidden")};socket.on("account-limit-reached",function(data){validReasonToDisconnect=true;eraseCookie("katacoda/environment-open");hide_environment_waiting();if(window.trackJs){trackJs.track("[WARN] Account Limit Reached",data.message)}hide_content();if(data.message){writeErrorMessageToAllTerminals(data.message)}else if(data.redirect){window.location=data.redirect}clearErrorTimers()});socket.on("error",function(err){eraseCookie("katacoda/environment-open");if(err==="handshake unauthorized"||err&&err.indexOf&&err.indexOf("not authorized")>=0){app.open_registration_modal();return}else{hide_environment_waiting();hide_content();if(err=="training-password-required"){writeErrorMessageToAllTerminals("Training Password Required. Please confirm you have registered and entered the correct password");if(window.trackJs)trackJs.track("[WARN] Training Password Required");validReasonToDisconnect=true}else if(environmentHasExpired()){writeErrorMessageToAllTerminals("The Katacoda environment has expired. Please refresh to start a fresh environment.\r\n");validReasonToDisconnect=true}else if(err&&err.indexOf("No Available Nodes">=0)){writeErrorMessageToAllTerminals("We are currently at capacity with no additional nodes available. Please check back in 10 minutes.\r\n");validReasonToDisconnect=true}else{if(!validReasonToDisconnect){writeErrorMessageToAllTerminals("Sorry, we encountered a problem. Support has been alerted.\r\n");writeErrorMessageToAllTerminals("Websocket Error - "+err)}if(err==="Error: xhr poll error"){if(window.mighthaveclosed){return}}if(err==="No session found"){writeErrorMessageToAllTerminals("Please logout/login again to reset your session.");validReasonToDisconnect=true}if(supported!=="false"){console.log("Websocket failed (error), falling back to Polling",err);document.cookie="websocketssupported=false";if(window.trackJs)trackJs.track("[WARN] Websockets Not Supported")}trackJs.track("Websocket Error - "+err)}if(window.course&&window.course.is_dirty)window.course.is_dirty(false)}clearErrorTimers()});socket.on("container-stopped",function(){eraseCookie("katacoda/environment-open");hide_environment_waiting();if(window.mighthaveclosed){return}writeErrorMessageToAllTerminals("The environment has expired.\r\n\r\nPlease refresh to get a new environment.");if(window.course&&window.course.is_dirty)window.course.is_dirty(false);if(!environmentHasExpired()){trackJs.track("Container Stopped")}validReasonToDisconnect=true;clearErrorTimers()});socket.on("container-force-stopped",function(data){eraseCookie("katacoda/environment-open");if(!data)trackJs.track("Socket Forced Disconnected");else trackJs.track("Socket Forced Disconnected - "+data.reason);clearErrorTimers()});socket.on("disconnect",function(){eraseCookie("katacoda/environment-open");hide_environment_waiting();if(window.mighthaveclosed){return}if(window.course&&window.course.is_dirty){window.course.is_dirty(false)}if(!validReasonToDisconnect){writeErrorMessageToAllTerminals("We encountered a problem with the connection.\r\nThis may have been due to the internet connection dropping.\r\n\r\nPlease refresh and try again.");if(!environmentHasExpired()){trackJs.track("Socket Disconnected")}}clearErrorTimers()});var validReasonToDisconnect=false;socket.on("err",function(data){eraseCookie("katacoda/environment-open");hide_environment_waiting();clearErrorTimers();if(window.mighthaveclosed){return}if(window.course&&window.course.is_dirty)window.course.is_dirty(false);try{var json=JSON.parse(data);if(json.json&&json.json.message){if(json.json.message.indexOf("No such image")>=0){writeErrorMessageToAllTerminals("This environment is no longer available. Please contact Support@Katacoda.com")}else{writeErrorMessageToAllTerminals("Error Details: Environment not starting correctly. Please contact Support@Katacoda.com")}validReasonToDisconnect=true;trackJs.track("Environment Error: "+JSON.stringify(data));return}}catch(e){}if(json.message&&json.message.indexOf("Not enough capacity available")>=0){writeErrorMessageToAllTerminals("The content owner's account has reached capacity. Please try again in 10 minutes");trackJs.track("Capacity Reached Error: "+json.message);validReasonToDisconnect=true}else if(json.message&&json.message==="Invalid Environment"){writeErrorMessageToAllTerminals("Please check the Katacoda Environment defined. Visit https://katacoda.com/docs/scenarios/environments for a list of supported environments, or contact Support@Katacoda.com for assistance.");validReasonToDisconnect=true}else if(json.message&&json.message.indexOf("No Available Nodes")>=0){writeErrorMessageToAllTerminals("We are currently at capacity with no additional nodes available. Please check back in 10 minutes.");validReasonToDisconnect=true}else{if(environmentHasExpired()){writeErrorMessageToAllTerminals("The Katacoda environment has expired. Please refresh to start a fresh environment.\r\n")}else{!validReasonToDisconnect;writeErrorMessageToAllTerminals("Oops! Sorry, we had a problem. Please refresh and try again.");trackJs.track("Socket Error: "+JSON.stringify(data))}try{var json=JSON.parse(data);if(json.message){writeErrorMessageToAllTerminals("Error - "+json.message)}}catch(e){}}});socket.on("payment_required",function(err){eraseCookie("katacoda/environment-open");hide_environment_waiting();app.open_payment_modal();clearErrorTimers()});socket.on("restricted",function(data){eraseCookie("katacoda/environment-open");hide_environment_waiting();app.open_restricted_modal(data.reason);clearErrorTimers()});socket.on("connect",function(){});socket.removeAllListeners("data-connected");socket.on("data-connected",function(data){clearTimeout(environmentTooLongWarningTimer);clearTimeout(environmentTooLongErrorTimer);clearTimeout(environmentTooLongerErrorTimer);window.katacodaHost=data.katacodaHost;window.katacodaDomain=data.katacodaDomain;window.course.view.project=data;window.course.view.project_name=data.name;var evt=document.createEvent("Events");evt.initEvent("terminal-ready-event",true,true);evt.socket=socket;document.dispatchEvent(evt);$.get("/details",function(response){var response;var command="echo '"+response+"' >> /tmp/d; ssh  -o ConnectionAttempts=30 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no root@host01 \"echo '"+response+"' >> /tmp/d;\"";socket.emit("course-data",command)});for(var i=0;i<terminals.length;i++){size=getSize(terminals[i]);socket.emit("terminal-resize",{cols:size.cols,rows:size.rows});terminals[i].fit()}hide_environment_waiting();that.intro(0,$("#intro"));var cmd=getParameterByName("cmd");if(cmd.indexOf("ssh")===0&&(cmd.indexOf("ssh root@host01")===-1&&cmd.indexOf("ssh root@docker")===-1))that.write(cmd);configureDropdown(data);var debugString="";debugString+="<p>Content Version: "+$('meta[name="gitCommit"]').attr("content")+"</p>";debugString+="<p>Last Updated: "+$('meta[name="lastUpdated"]').attr("content")+"</p>";debugString+="<p>Connected - Katacoda Host: "+window.katacodaHost+"</p>";var nodeips="";if(window.course.view.project.hosts){for(var i=0;i<window.course.view.project.hosts.length;i++){var host=window.course.view.project.hosts[i];nodeips+=host.type+i+" IP: "+host.ip+"</br>"}}debugString+="<p>"+nodeips+"</p>";$("#debug-info").html(debugString);if(course.course.backend.reuseConnection){$("#poweroff").removeClass("hidden")}});socket.removeAllListeners("data-exec-connected");socket.on("data-exec-connected",function(data){for(var i=0;i<terminals.length;i++){size=getSize(terminals[i]);socket.emit("exec-terminal-resize",{cols:size.cols,rows:size.rows});terminals[i].fit()}});socket.on("save-file-resp",function(evt){$('.ktab.kfiletab[data-path="./'+evt.file+'"] a.tab-progress').addClass("hidden");if(evt.err){trackJs.track("Error saving file "+evt.file);alert("Error saving file "+evt.file)}});var configureDropdown=function(data){var environmentsDashboardUrlExtenstionProtocol=window.course.course.backend.environmentsprotocol||"https";var environmentsDashboardUrlExtenstion=window.course.course.backend.environmentsdomain||window.katacodaDomain||".environments.katacoda.com";var defaultPort=window.course.course.backend.port;if(data.hosts.length>=1){$(".browser-link").removeClass("hidden");if(data.hosts.length>0){var count={};var h=data.hosts[0];var dropdown=$("#webpreview-dropdown-terminal");dropdown.append('<li><a class="add-new-terminal" data-host="HOST1">Open New Terminal</a></li>');dropdown.append('<li class="divider"></li>');for(var i=0;i<data.hosts.length;i++){var h=data.hosts[i];count[h.type]=count[h.type]||1;var port1=h.port||defaultPort||"80";var url1=environmentsDashboardUrlExtenstionProtocol+"://"+h.subdomain+"-"+port1+"-"+(h.katacodahost||katacodaHost)+environmentsDashboardUrlExtenstion;var changeUrl1=environmentsDashboardUrlExtenstionProtocol+"://"+h.subdomain+"-"+(h.katacodahost||katacodaHost)+environmentsDashboardUrlExtenstion;dropdown.append('<li><a href="'+url1+'" target="_blank">View HTTP port '+port1+" on "+h.type.toCapital()+" "+count[h.type]+"</a></li>");dropdown.append('<li><a href="'+changeUrl1+'" target="_blank">Select port to view on '+h.type.toCapital()+" "+count[h.type]+"</a></li>");dropdown.append('<li class="divider"></li>');count[h.type]++}}configureIFrames(data,defaultPort);updateScenarioPlaceholders();hookNewTerminalCommand()}};var environmentHasExpired=function(){var now=new Date;var timeSinceStart=now-startedSessionTime;var twohours=72e5;var fourityfiveminutes=27e5;var fourityminutes=24e5;return timeSinceStart>fourityminutes};var configureIFrames=function(data,defaultPort){var environmentsDashboardUrlExtenstionProtocol=window.course.course.backend.environmentsprotocol||"https";var environmentsDashboardUrlExtenstion=window.course.course.backend.environmentsdomain||window.katacodaDomain||".environments.katacoda.com";if(window.course.course.backend.url){var iframe=$("iframe");iframe.attr("src",window.course.course.backend.url);return}if(data.hosts.length>0){var h=data.hosts[0];var port1=h.port||defaultPort||"80";var newWindowTab=$(".ktab.new-window");newWindowTab.each(function(i,e){var newWindowTabPort=$(e).attr("data-port")||port1;var subdomain=h.subdomain;var targetKatacodaHostName=katacodaHost;var host=$(e).attr("data-host");if(host){host=host.replace("HOST","");host=parseInt(host,10);if(host){var targetHost=data.hosts[host-1];if(targetHost){subdomain=targetHost.subdomain;if(targetHost.katacodahost)targetKatacodaHostName=targetHost.katacodahost}}}var newWindowUrl=environmentsDashboardUrlExtenstionProtocol+"://"+subdomain+"-"+newWindowTabPort+"-"+(h.katacodahost||katacodaHost)+environmentsDashboardUrlExtenstion;$(e).attr("data-src",newWindowUrl)});var iFrameView=$("#terminal-iframe-v1-view, #embedded-terminal-iframe-v1-view");var iframeTabs=$(".iframetab");if(iFrameView.length===1&&iframeTabs.length>0){for(var i=0;i<iframeTabs.length;i++){var tab=iframeTabs[i];if($(tab).attr("data-src")!=="")continue;var port=$(tab).attr("data-port")||defaultPort||"80";var tabUrl=environmentsDashboardUrlExtenstionProtocol+"://"+h.subdomain+"-"+port+"-"+(h.katacodahost||katacodaHost)+environmentsDashboardUrlExtenstion;var iframe=$("iframe#"+port);iframe.attr("src",tabUrl)}$("#tutorial .step a",iFrameView).click(function(e){var link=$(this);var href=link.attr("href");if(href.indexOf("environments.katacoda.com")>0){var parts=href.split("-");if(parts.length>2){var port=parts[1];var tab=$("#itab-"+port);if(tab.length===1){var iframeTarget=$("iframe#"+port);if(iframeTarget&&iframeTarget.attr("src")!==href)iframeTarget.attr("src",href);tab.click();return false}}}});$("code.execute",iFrameView).click(function(e){$(".ktab[data-view-id='terminal']").click()})}}$(".refresh-iframe-tab").click(function(){var i=$(this);var tab=i.parents(".iframetab");var iframe=$("#"+tab.attr("data-view-id"));var targetUrl=iframe.attr("src");iframe.attr("src","about:blank");iframe.attr("src",targetUrl);return false});$(".external-iframe-tab").click(function(){var i=$(this);var tab=i.parents(".iframetab");var iframe=$("#"+tab.attr("data-view-id"));var targetUrl=iframe.attr("src");var win=window.open(targetUrl,"_blank");win.focus();return false})};var updateScenarioPlaceholders=function(){var hostsCount=0;var clientsCount=0;if(!window.course.view.project||!window.course.view.project.hosts)return;if(window.course.view.project.hosts.length===1){var h=window.course.view.project.hosts[0];$("#tutorial code").text(function(i2,v){return templateHostsInTutorial(v,hostsCount,h,katacodaHost)});$("#tutorial pre.file").html(function(i2,v){return templateHostsInTutorial(v,hostsCount,h,katacodaHost)});$("#tutorial a, a.ktab").text(function(i2,v){return templateHostsInTutorial(v,hostsCount,h,katacodaHost)});$("#tutorial a, a.ktab").attr("href",function(i2,v){return templateHostsInTutorial(v,hostsCount,h,katacodaHost)});$("#split-host iframe").attr("src",function(i2,v){return templateHostsInTutorial(v,hostsCount,h,katacodaHost)});$("#tutorial code").text(function(i2,v){return templateClientsInTutorial(v,clientsCount,h,katacodaHost)});$("#tutorial pre.file").html(function(i2,v){return templateClientsInTutorial(v,hostsCount,h,katacodaHost)});$("#tutorial a, a.ktab").text(function(i2,v){return templateClientsInTutorial(v,clientsCount,h,katacodaHost)});$("#tutorial a, a.ktab").attr("href",function(i2,v){return templateClientsInTutorial(v,clientsCount,h,katacodaHost)});$("#split-host iframe").attr("src",function(i2,v){return templateClientsInTutorial(v,clientsCount,h,katacodaHost)})}else{for(var i=0;i<window.course.view.project.hosts.length;i++){var h=window.course.view.project.hosts[i];if(h.type==="host"){$("#tutorial code").text(function(i2,v){return templateHostsInTutorial(v,hostsCount,h,katacodaHost)});$("#tutorial pre.file").html(function(i2,v){return templateHostsInTutorial(v,hostsCount,h,katacodaHost)});$("#tutorial a, a.ktab").text(function(i2,v){return templateHostsInTutorial(v,hostsCount,h,katacodaHost)});$("#tutorial a, a.ktab").attr("href",function(i2,v){return templateHostsInTutorial(v,hostsCount,h,katacodaHost)});$("#split-host iframe").attr("src",function(i2,v){return templateHostsInTutorial(v,hostsCount,h,katacodaHost)});hostsCount++}else{$("#tutorial code").text(function(i2,v){return templateClientsInTutorial(v,clientsCount,h,katacodaHost)});$("#tutorial pre.file").html(function(i2,v){return templateClientsInTutorial(v,hostsCount,h,katacodaHost)});$("#tutorial a, a.ktab").text(function(i2,v){return templateClientsInTutorial(v,clientsCount,h,katacodaHost)});$("#tutorial a, a.ktab").attr("href",function(i2,v){return templateClientsInTutorial(v,clientsCount,h,katacodaHost)});$("#split-host iframe").attr("src",function(i2,v){return templateClientsInTutorial(v,clientsCount,h,katacodaHost)});clientsCount++}}}};var hookNewTerminalCommand=function(){$(".add-new-terminal").click(function(){var loadCommand=$(this).attr("data-command");var existingTab=undefined;if($(this).hasClass("ktab")){if($(this).hasClass("add-new-terminal")){existingTab=$(this);existingTab.removeClass("add-new-terminal")}else{return}}var container;var host=$(this).attr("data-host");if(host.indexOf("0")>=0){host=host.replace(/0/g,"")}host=host.toUpperCase();var isSplit=$(this).parents(".split");if(isSplit.length>0){container=isSplit}else{container=$(this).parents("#split-host")}createAdditionalTerminal(container,host,loadCommand,existingTab)})};socket.removeAllListeners("data");socket.on("data",function(data){if(terminals.length===0)return console.log("data",data);for(var i=0;i<terminals.length;i++){var t=terminals[i];if(data.host===t.host){t.write(data.data)}}});socket.removeAllListeners("verify-data");socket.on("verify-data",function(data){if(console&&console.log){console.log("Verify Data",data)}that.verify_step_change(data)});socket.removeAllListeners("course-data");socket.on("course-data",function(data){if(console&&console.log){console.log("Background Output",data)}});var writeErrorMessageToAllTerminals=function(msg){for(var i=0;i<terminals.length;i++){terminals[i].write("\r\n\r\n[31m"+msg+"[m\r\n")}};$("code.execute").click(function(){$(this).addClass("executed");var ctrlC="";var e=$(this).text();var cls=$(this).attr("class");var hasHost=cls.indexOf("HOST")>=0;var hasTerminal=cls.match(/\s+(T\d)/);var hasInterrupt=$(this).hasClass("interrupt");var terminalTarget;var existingTerminals=$(".terminal-container");var pendingTerminalTabs=$(".ktab.add-new-terminal");var writeTarget=that.write;if($(this).hasClass("windows")){writeTarget=that.writeWindows}if(hasTerminal&&hasTerminal.length>=1){terminalTarget=parseInt(hasTerminal[1][1],10);if(existingTerminals.length+pendingTerminalTabs.length>=terminalTarget){var tabs=$(".ktab[data-host]:not(.iframetab):not(.new-window)");var tab=$(tabs[terminalTarget-1]);var active=$(existingTerminals[terminalTarget-1]);var host=active.attr("data-host");if(active.length===0){tab.click();setTimeout(function(){if(hasInterrupt)writeTarget(ctrlC,host);writeTarget(e,host)},300)}else{tab.click();if(hasInterrupt)writeTarget(ctrlC,host);writeTarget(e,host)}}else{var newTermButton=$('.add-new-terminal[data-host="HOST1"]');newTermButton.click();setTimeout(function(){var active=$(".terminal-container:last");var host=active.attr("data-host");if(hasInterrupt)writeTarget(ctrlC,host);writeTarget(e,host)},300)}return}else if(hasHost){var host=cls.match(/HOST(.*?)\w/);if(host&&host.length>0){$('.ktab[data-host="'+host[0]+'"]').click();if(hasInterrupt)writeTarget(ctrlC,host[0]);writeTarget(e,host[0]);return}else writeTarget(e)}else if(existingTerminals.length>1){var activeTerminal=$(".terminal-container:not(.offscreen)");var activeTerminalIndex=existingTerminals.index(activeTerminal);terminalTarget=parseInt(activeTerminalIndex,10);if(existingTerminals.length>=terminalTarget){var host=activeTerminal.attr("data-host");if(hasInterrupt)writeTarget(ctrlC,host);writeTarget(e,host)}}else{var tabs=$(".ktab[data-host]:not(.iframetab):not(.new-window)");if(tabs.length>0)tabs[0].click();if(hasInterrupt)writeTarget(ctrlC);writeTarget(e)}});$("code.execute").attr("title","Run command");$("code.paste").attr("title","Copy to Clipboard");var clipboard=new Clipboard("code.paste",{target:function(trigger){return trigger}});clipboard.on("success",function(e){$(e.trigger).addClass("active");setTimeout(function(){$(e.trigger).removeClass("active")},300);e.clearSelection()});$("code.copy").attr("title","Copy to Clipboard");var clipboard2=new Clipboard("code.copy",{target:function(trigger){return trigger}});clipboard2.on("success",function(e){$(e.trigger).addClass("active");setTimeout(function(){$(e.trigger).removeClass("active")},300);e.clearSelection()});$("code.ui").click(function(e){e.preventDefault();var trigger=$(this);var text=trigger.text();var element=trigger.attr("class").replace("ui ","");console.log("text",text);console.log("element",element);$(trigger).addClass("active");setTimeout(function(){$(trigger).removeClass("active")},1e3)});var embeddedWriteTerm=function(evt){if(evt&&evt.data&&evt.data.cmd==="writeTerm"){that.write(evt.data.data)}if(evt&&evt.data&&evt.data.cmd==="writeToEnvironment"){that.write_to_environment(evt.data.data)}};window.addEventListener("message",embeddedWriteTerm,false);window.addEventListener("resize",function(){for(var i=0;i<terminals.length;i++){size=getSize(terminals[i]);socket.emit("terminal-resize",{cols:size.cols,rows:size.rows});terminals[i].fit()}});var t=$("#terminal");if(t.length>0){createTerm(t,"HOST1")}var t1=$("#terminal2");if(t1.length>0){createTerm(t1,"HOST2")}var settings=new Settings;settings.init()};function getSize(term){if(!term.element.parentElement){return null}var parentElementStyle=window.getComputedStyle(term.element.parentElement),parentElementHeight=parseInt(parentElementStyle.getPropertyValue("height")),parentElementWidth=Math.max(0,parseInt(parentElementStyle.getPropertyValue("width"))-17),elementStyle=window.getComputedStyle(term.element),elementPaddingVer=parseInt(elementStyle.getPropertyValue("padding-top"))+parseInt(elementStyle.getPropertyValue("padding-bottom")),elementPaddingHor=parseInt(elementStyle.getPropertyValue("padding-right"))+parseInt(elementStyle.getPropertyValue("padding-left")),availableHeight=parentElementHeight-elementPaddingVer,availableWidth=parentElementWidth-elementPaddingHor,container=term.rowContainer,subjectRow=term.rowContainer.firstElementChild,contentBuffer=subjectRow.innerHTML,characterHeight,rows,characterWidth,cols,geometry;subjectRow.style.display="inline";subjectRow.innerHTML="W";characterWidth=subjectRow.getBoundingClientRect().width;subjectRow.style.display="";characterHeight=subjectRow.getBoundingClientRect().height;subjectRow.innerHTML=contentBuffer;rows=parseInt(availableHeight/characterHeight);cols=parseInt(availableWidth/characterWidth);geometry={cols:cols,rows:rows};return geometry}var createTerm=function(t,tmpHost,termWelcomeMessage){var id=$(t).attr("id");var host=$(t).attr("data-host")||tmpHost;if(id===undefined)console.warn("Terminal does not have ID.");var term=new Terminal({useStyle:true,screenKeys:false,cursorBlink:true});term.attachCustomKeyEventHandler(function(e){if(e.ctrlKey&&e.shiftKey&&(e.keyCode==3||e.keyCode==88)){var copySucceeded=document.execCommand("copy");console.log("copy succeeded",copySucceeded);return false}});term.host=host;term.id=id;terminals.push(term);t.html("");term.open(t[0]);if(termWelcomeMessage)term.write(termWelcomeMessage);else if(window.course.course.environment&&window.course.course.environment.uimessage1)term.write(window.course.course.environment.uimessage1);else term.write("[32mYour Interactive Bash Terminal.[m\r\n");term.removeAllListeners("resize");term.on("resize",function(size){socket.emit("terminal-resize",{cols:size.cols,rows:size.rows});socket.emit("exec-terminal-resize",{cols:size.cols,rows:size.rows})});term.removeAllListeners("data");term.on("data",function(data){if(data===undefined||data==="undefined"||data===""){return}else{socket.emit("data",{host:host,data:data})}});term.on("title",function(title){});return undefined};var defaultTerminalHost=function(val){if(val)return val;else return"HOST1"};var createAdditionalTerminal=function(context,host,loadCommand,existingTab){var id=$(".terminal-container").length+1;var terminalId="terminal"+id;var targetHost=host||"HOST1";var hostId=targetHost+"-"+terminalId;socket.emit("attach-term",{originalHost:host,host:hostId});var termHtml=Handlebars.templates["terminal.hbs"]({id:terminalId,host:hostId,defaultTerminalHost:defaultTerminalHost});var embedded=$("#embedded-terminal",context);if(embedded.length>0){$(embedded).append(termHtml)}else{$(context).append(termHtml)}var t=$("#"+terminalId);createTerm(t,hostId,"[32mExtra Interactive Bash Terminal[m\r\n");if(existingTab){$(existingTab).attr("data-view-id",terminalId)}else{var tabHtml=Handlebars.templates["tab.hbs"]({id:terminalId,host:hostId,name:"Terminal "+id});$(".tabbar .ktabs",context).append(tabHtml);$(".ktab[data-view-id='"+terminalId+"']",context).click()}window.app.fireResize();if(loadCommand){setTimeout(function(){that.write(loadCommand,hostId)},600)}};var Settings=function(){this.init=function(){$(document).keypress(function(event){if(event.keyCode==13&&event.shiftKey){$("#fullscreen").click()}});$(document).bind("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(e){var state=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen;var event=state?"FullscreenOn":"FullscreenOff";if(!state){$("#split-host").removeClass("fullscreen")}});$("#presentation-mode").click(function(e){e.preventDefault();var ev=$(this);setTerminalMode(ev,"presentation");for(var i=0;i<terminals.length;i++){size=getSize(terminals[i]);socket.emit("terminal-resize",{cols:size.cols,rows:size.rows});terminals[i].fit()}setTimeout(function(){for(var i=0;i<terminals.length;i++){size=getSize(terminals[i]);socket.emit("terminal-resize",{cols:size.cols,rows:size.rows});terminals[i].fit()}},300);return false});$("#light-colour-schema").click(function(e){e.preventDefault();var ev=$(this);setTerminalMode(ev,"light-colour-schema");return false});$("#fullscreen").click(function(e){e.preventDefault();var target=document.getElementById("split-host");if(!document.webkitIsFullScreen&&!document.mozFullScreen&&!document.msFullscreenElement){$("#split-host").addClass("fullscreen");if(target.requestFullscreen){target.requestFullscreen()}else if(target.msRequestFullscreen){target.msRequestFullscreen()}else if(target.mozRequestFullScreen){target.mozRequestFullScreen()}else if(target.webkitRequestFullscreen){target.webkitRequestFullscreen()}}else{$("#split-host").removeClass("fullscreen");if(document.cancelFullScreen){document.cancelFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}return false});$("#debug").click(function(e){e.preventDefault();$("#debug-model").modal({dismissible:false,opacity:.8,top:"5%"}).modal("open");return false});$("#poweroff").click(function(e){e.preventDefault();if(window.course.view.write){var retVal=confirm("Are you sure you want to shutdown and remove the cluster?");if(retVal==true){var shutdown="echo 1 > /proc/sys/kernel/sysrq; echo o > /proc/sysrq-trigger";var instances=[];var hosts=window.course.view.project.hosts;for(var i=0;i<hosts.length;i++){var element=hosts[i];if(element&&element.type==="host"){instances.push(element)}}var shutdownCmd="";if(instances.length===0){shutdownCmd="exit"}else{var lastHostFirst=instances.reverse();for(var i=0;i<lastHostFirst.length;i++){var element=lastHostFirst[i];shutdownCmd+="ssh -o StrictHostKeyChecking=no root@"+element.ip+" '"+shutdown+"'; "}}window.course.view.write("echo 'Shutting Down'; "+shutdownCmd)}}else{alert("Coming soon")}return false});var setTerminalMode=function(ev,cls){if(ev.hasClass("selected")){ev.removeClass("selected");$(".terminal-container, .terminal, .ace_editor").removeClass(cls)}else{ev.addClass("selected");$(".terminal-container, .terminal, .ace_editor").addClass(cls)}}}};var next_step;this.validate_step_change=function(step){if(step.attr("data-verify")!==""){next_step=step;next_step.find(".btn.next").text("Checking...");var code=step.attr("data-verify");var hostsCount=0;var clientsCount=0;if(window.course.view.project===undefined||window.course.view.project.hosts===undefined)return;if(window.course.view.project.hosts.length===1){var h=window.course.view.project.hosts[0];code=templateHostsInTutorial(code,hostsCount,h,katacodaHost);code=templateClientsInTutorial(code,clientsCount,h,katacodaHost)}else{for(var i=0;i<window.course.view.project.hosts.length;i++){var h=window.course.view.project.hosts[i];if(h.type==="host"){code=templateHostsInTutorial(code,hostsCount,h,katacodaHost);hostsCount++}else{code=templateClientsInTutorial(code,clientsCount,h,katacodaHost);clientsCount++}}}socket.emit("verify-data",code)}else{window.course.go_to_next_step(step)}};this.verify_step_change=function(data){var step=next_step;setTimeout(function(){step.find(".btn.next").text("Continue")},1e3);if(data.indexOf("done")===-1){window.course.block_next_step(step)}else{window.course.go_to_next_step(step)}};var remove_control_characters=function(data){return decodeURIComponent(encodeURIComponent(data)).trim()};this.write=function(text,host){if(text===undefined||text==="undefined"||text==="")return;if(host)socket.emit("data",{host:host,data:text+"\r"});else socket.emit("data",text+"\r")};this.writeWindows=function(text,host){if(text===undefined||text==="undefined"||text==="")return;if(host)socket.emit("data",{host:host,data:text+"\r\n"});else socket.emit("data",text+"\r\n")};this.paste=function(text){if(text===undefined||text==="undefined"||text==="")return;socket.emit("data",text)};this.intro=function(id,step){that.next_step(id,step)};this.next_step=function(id,step){if(that.is_ready===false){that.need_to_execute_steps.push([id,step]);return}var timeout=0;if(environment_data.indexOf(id)===-1){environment_data.push(id);var courseData=step.attr("data-course-data");var code=unescape(courseData);if(code!==undefined&&code!==""&&code!=="undefined"){var assetTargetURL=window.location.href;if(window.location.href[window.location.href.length-1]!=="/"){assetTargetURL+="/assets/"}else{assetTargetURL+="assets/"}code=code.replace(/KATACODA_ASSETS_URL/g,assetTargetURL);var hostsCount=0;var clientsCount=0;if(!window.course.view.project||!window.course.view.project.hosts)return;if(window.course.view.project.hosts.length===1){var h=window.course.view.project.hosts[0];code=templateHostsInTutorial(code,hostsCount,h,katacodaHost);code=templateClientsInTutorial(code,clientsCount,h,katacodaHost)}else{for(var i=0;i<window.course.view.project.hosts.length;i++){var h=window.course.view.project.hosts[i];if(h.type==="host"){code=templateHostsInTutorial(code,hostsCount,h,katacodaHost);hostsCount++}else{code=templateClientsInTutorial(code,clientsCount,h,katacodaHost);clientsCount++}}}var parsed_code=$.parseHTML(code)[0];if(parsed_code!==""){var snippets=parsed_code.textContent.split("\\n").clean("");var joined_snippets=snippets.join(" && ");this.write_to_environment(joined_snippets);timeout=600}}}if(copied_code.indexOf(id)===-1){copied_code.push(id);var code=unescape(step.attr("data-code"));if(code!==undefined&&code!==""&&code!=="undefined"){var hostsCount=0;var clientsCount=0;if(!window.course.view.project||!window.course.view.project.hosts)return;if(window.course.view.project.hosts.length===1){var h=window.course.view.project.hosts[0];code=templateHostsInTutorial(code,hostsCount,h,katacodaHost);code=templateClientsInTutorial(code,clientsCount,h,katacodaHost)}else{for(var i=0;i<window.course.view.project.hosts.length;i++){var h=window.course.view.project.hosts[i];if(h.type==="host"){code=templateHostsInTutorial(code,hostsCount,h,katacodaHost);hostsCount++}else{code=templateClientsInTutorial(code,clientsCount,h,katacodaHost);clientsCount++}}}var parsed_code=$.parseHTML(code)[0];if(parsed_code!==""){var snippets=parsed_code.textContent.split("\\n").clean("");setTimeout(function(){for(var i=0;i<snippets.length;i++){var snippet=snippets[i];that.write(snippet)}},timeout)}}}};this.write_to_environment=function(data){socket.emit("course-data",data)};this.saveFile=function(data){socket.emit("save-file",data);$('.ktab.kfiletab[data-path="./'+data.file+'"] a.tab-progress').removeClass("hidden")};this.download=function(){var download_url="/"+app.user.username+"/"+window.course.course["pathwayId"]+"/"+window.course.course.id+"/"+window.course.view.project.name+"/assets";$("body").append("<iframe src='"+download_url+"' style='display: none;' ></iframe>")};var show_environment_waiting=function(){if(that.is_ready===false){var html=Handlebars.templates["connecting.hbs"];if(html){var termWait=$("#terminal-wait");var waiting=termWait.html(html);if($("#embedded-terminal-editor").length===0&&$("#embedded-terminal-editor-split").length===0){$("#tutorial, #split-host").addClass("blurry-background");$(".course-container").append(waiting)}}}};var hide_environment_waiting=function(){that.is_ready=true;clearTimeout(environmentWarningTimer);$("#tutorial, #split-host").removeClass("blurry-background");$("#terminal-wait").remove();for(var i=0;i<that.need_to_execute_steps.length;i++){var argu=that.need_to_execute_steps[i];that.next_step(argu[0],argu[1])}};var getWSURL=function(image){if(window.katacoda_ws_endpoint!==undefined&&window.katacoda_ws_endpoint!=="")return"//"+window.katacoda_ws_endpoint+".katacoda.com";var host=window.location.host;if(host.indexOf("beta")>=0){return"//betaws.katacoda.com"}if(host.indexOf("fresco")>=0){return"//ws.fresco.katacoda.com"}if(host.indexOf("tcs-xplore")>=0){return"//tcs-xplore.katacoda.com"}if(window.location.pathname.indexOf("dxc")>=0){return"//ws1.katacoda.com"}if(window.location.pathname.indexOf("virtuant")>=0){return"//ws1.katacoda.com"}if(window.location.pathname.indexOf("mmumshad")>=0){return"//ws29.katacoda.com"}if(image.indexOf("iotedgedev")>=0){return"//ws2.katacoda.com"}if(problematicBrowser()&&host.indexOf("localhost")===-1){return"//ws14.katacoda.com"}if(host.indexOf("katacoda")>=0){if(host.indexOf("host")>=0){var number=host.match(/host(\d+)/);if(number&&number.length===2)return"//ws"+number[1]+".katacoda.com"}if(host.indexOf("www2")>=0){return"//www-ws2.katacoda.com"}return"//ws.katacoda.com"}return"//"+host};var problematicBrowser=function(){try{var isIE=detectIE();return isIE||!navigator.cookieEnabled}catch(e){return true}};function detectIE(){var ua=window.navigator.userAgent;var msie=ua.indexOf("MSIE ");if(msie>0){return parseInt(ua.substring(msie+5,ua.indexOf(".",msie)),10)}var trident=ua.indexOf("Trident/");if(trident>0){var rv=ua.indexOf("rv:");return parseInt(ua.substring(rv+3,ua.indexOf(".",rv)),10)}var edge=ua.indexOf("Edge/");if(edge>0){return parseInt(ua.substring(edge+5,ua.indexOf(".",edge)),10)}return false}var templateHostsInTutorial=function(v,i,h,katacodaHost){var v2="";if(i===0){v2=v.replace(/\[\[HOST1\]\]/g,h.name).replace(/\[\[HOST1_IP\]\]/g,h.ip).replace(/\[\[HOST1_{\]\]/g,h.subdomain);v2=v2.replace(/\[\[HOST\]\]/g,h.name).replace(/\[\[HOST_IP\]\]/g,h.ip).replace(/\[\[HOST_SUBDOMAIN\]\]/g,h.subdomain);v2=v2.replace(/\[\[HOST1_HOST\]\]/g,h.katacodahost||katacodaHost);v2=v2.replace(/\[\[HOST_HOST\]\]/g,h.katacodahost||katacodaHost);v2=v2.replace(/\[\[KATACODA_HOST\]\]/g,h.katacodahost||katacodaHost);v2=v2.replace(/\[\[KATACODA_DOMAIN\]\]/g,h.katacodadomain||window.katacodaDomain||".environments.katacoda.com");return v2}else{v2=v.replace(new RegExp("\\[\\[HOST"+(i+1)+"\\]\\]","g"),h.name).replace(new RegExp("\\[\\[HOST"+(i+1)+"_IP\\]\\]","g"),h.ip);v2=v2.replace(new RegExp("\\[\\[HOST"+(i+1)+"_SUBDOMAIN\\]\\]","g"),h.subdomain);v2=v2.replace(new RegExp("\\[\\[HOST"+(i+1)+"_HOST\\]\\]","g"),h.katacodahost||katacodaHost);v2=v2.replace(new RegExp("\\[\\[HOST"+(i+1)+"_DOMAIN\\]\\]","g"),h.katacodadomain||window.katacodaDomain||".environments.katacoda.com");v2=v2.replace(/\[\[KATACODA_HOST\]\]/g,h.katacodahost||katacodaHost);v2=v2.replace(/\[\[KATACODA_DOMAIN\]\]/g,h.katacodadomain||window.katacodaDomain||".environments.katacoda.com");return v2}};var templateClientsInTutorial=function(v,i,h,katacodaHost){if(i===0){v=v.replace(/\[\[CLIENT1\]\]/g,h.name).replace(/\[\[CLIENT1_IP\]\]/g,h.ip).replace(/\[\[CLIENT1_SUBDOMAIN\]\]/g,h.subdomain);v=v.replace(/\[\[CLIENT\]\]/g,h.name).replace(/\[\[CLIENT_IP\]\]/g,h.ip).replace(/\[\[CLIENT_SUBDOMAIN\]\]/g,h.subdomain);v=v.replace(/\[\[KATACODA_HOST\]\]/g,h.katacodahost||katacodaHost);v=v.replace(/\[\[KATACODA_DOMAIN\]\]/g,h.katacodadomain||window.katacodaDomain||".environments.katacoda.com");return v}else{v=v.replace(new RegExp("\\[\\[CLIENT"+(i+1)+"\\]\\]","g"),h.name).replace(new RegExp("\\[\\[CLIENT"+(i+1)+"_IP\\]\\]","g"),h.ip);v=v.replace(new RegExp("\\[\\[CLIENT"+(i+1)+"_SUBDOMAIN\\]\\]","g"),h.subdomain);v=v.replace(/\[\[KATACODA_HOST\]\]/g,h.katacodahost||katacodaHost);v=v.replace(/\[\[KATACODA_DOMAIN\]\]/g,h.katacodadomain||window.katacodaDomain||".environments.katacoda.com");return v}}};var TerminalRdpViewLayout=function(){var TERMINAL_READY="terminal-ready-event";this.init=function(opts){var termView=new TerminalViewLayout;termView.init(opts);document.addEventListener(TERMINAL_READY,configureRdp)};var configureRdp=function(){var opts=window.course.view.project;var wst=new Guacamole.WebSocketTunnel("ws://rdp.katacoda.com/");var client=new Guacamole.Client(wst);client.onerror=function(error){console.log(error)};document.getElementById("rdp-display").appendChild(client.getDisplay().getElement());client.connect("token="+opts.token);window.onunload=function(){client.disconnect()};var mouse=new Guacamole.Mouse(client.getDisplay().getElement());mouse.onmousedown=mouse.onmouseup=mouse.onmousemove=function(mouseState){client.sendMouseState(mouseState)};var keyboard=new Guacamole.Keyboard(document);keyboard.onkeydown=function(keysym){client.sendKeyEvent(1,keysym)};keyboard.onkeyup=function(keysym){client.sendKeyEvent(0,keysym)}}};var ScopeTerminalViewLayout=function(){var TERMINAL_READY="terminal-ready-event";this.init=function(opts){document.addEventListener(TERMINAL_READY,configure);window.course.view=new TerminalViewLayout;window.course.view.init(opts)};var configure=function(){var host=window.course.view.project.hosts[0];window.course.view.write_to_environment(window.course.course.environment.scope);setTimeout(function(){$("#visualise").attr("src","https://"+host.subdomain+"-"+(window.course.course.environment.scopeport||4040)+"-"+host.katacodahost+".environments.katacoda.com")},1e4)}};!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Clipboard=t()}}(function(){var t,e,n;return function t(e,n,o){function i(a,c){if(!n[a]){if(!e[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(r)return r(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[a]={exports:{}};e[a][0].call(u.exports,function(t){var n=e[a][1][t];return i(n?n:t)},u,u.exports,t,e,n,o)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(t,e,n){var o=t("matches-selector");e.exports=function(t,e,n){for(var i=n?t:t.parentNode;i&&i!==document;){if(o(i,e))return i;i=i.parentNode}}},{"matches-selector":5}],2:[function(t,e,n){function o(t,e,n,o,r){var a=i.apply(this,arguments);return t.addEventListener(n,a,r),{destroy:function(){t.removeEventListener(n,a,r)}}}function i(t,e,n,o){return function(n){n.delegateTarget=r(n.target,e,!0),n.delegateTarget&&o.call(t,n)}}var r=t("closest");e.exports=o},{closest:1}],3:[function(t,e,n){n.node=function(t){return void 0!==t&&t instanceof HTMLElement&&1===t.nodeType},n.nodeList=function(t){var e=Object.prototype.toString.call(t);return void 0!==t&&("[object NodeList]"===e||"[object HTMLCollection]"===e)&&"length"in t&&(0===t.length||n.node(t[0]))},n.string=function(t){return"string"==typeof t||t instanceof String},n.fn=function(t){var e=Object.prototype.toString.call(t);return"[object Function]"===e}},{}],4:[function(t,e,n){function o(t,e,n){if(!t&&!e&&!n)throw new Error("Missing required arguments");if(!c.string(e))throw new TypeError("Second argument must be a String");if(!c.fn(n))throw new TypeError("Third argument must be a Function");if(c.node(t))return i(t,e,n);if(c.nodeList(t))return r(t,e,n);if(c.string(t))return a(t,e,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function i(t,e,n){return t.addEventListener(e,n),{destroy:function(){t.removeEventListener(e,n)}}}function r(t,e,n){return Array.prototype.forEach.call(t,function(t){t.addEventListener(e,n)}),{destroy:function(){Array.prototype.forEach.call(t,function(t){t.removeEventListener(e,n)})}}}function a(t,e,n){return s(document.body,t,e,n)}var c=t("./is"),s=t("delegate");e.exports=o},{"./is":3,delegate:2}],5:[function(t,e,n){function o(t,e){if(r)return r.call(t,e);for(var n=t.parentNode.querySelectorAll(e),o=0;o<n.length;++o)if(n[o]==t)return!0;return!1}var i=Element.prototype,r=i.matchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector;e.exports=o},{}],6:[function(t,e,n){function o(t){var e;if("INPUT"===t.nodeName||"TEXTAREA"===t.nodeName)t.focus(),t.setSelectionRange(0,t.value.length),e=t.value;else{t.hasAttribute("contenteditable")&&t.focus();var n=window.getSelection(),o=document.createRange();o.selectNodeContents(t),n.removeAllRanges(),n.addRange(o),e=n.toString()}return e}e.exports=o},{}],7:[function(t,e,n){function o(){}o.prototype={on:function(t,e,n){var o=this.e||(this.e={});return(o[t]||(o[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){function o(){i.off(t,o),e.apply(n,arguments)}var i=this;return o._=e,this.on(t,o,n)},emit:function(t){var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),o=0,i=n.length;for(o;i>o;o++)n[o].fn.apply(n[o].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),o=n[t],i=[];if(o&&e)for(var r=0,a=o.length;a>r;r++)o[r].fn!==e&&o[r].fn._!==e&&i.push(o[r]);return i.length?n[t]=i:delete n[t],this}},e.exports=o},{}],8:[function(e,n,o){!function(i,r){if("function"==typeof t&&t.amd)t(["module","select"],r);else if("undefined"!=typeof o)r(n,e("select"));else{var a={exports:{}};r(a,i.select),i.clipboardAction=a.exports}}(this,function(t,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=n(e),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),c=function(){function t(e){o(this,t),this.resolveOptions(e),this.initSelection()}return t.prototype.resolveOptions=function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action=e.action,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""},t.prototype.initSelection=function t(){this.text?this.selectFake():this.target&&this.selectTarget()},t.prototype.selectFake=function t(){var e=this,n="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return e.removeFake()},this.fakeHandler=document.body.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[n?"right":"left"]="-9999px",this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=(0,i.default)(this.fakeElem),this.copyText()},t.prototype.removeFake=function t(){this.fakeHandler&&(document.body.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)},t.prototype.selectTarget=function t(){this.selectedText=(0,i.default)(this.target),this.copyText()},t.prototype.copyText=function t(){var e=void 0;try{e=document.execCommand(this.action)}catch(n){e=!1}this.handleResult(e)},t.prototype.handleResult=function t(e){e?this.emitter.emit("success",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)}):this.emitter.emit("error",{action:this.action,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})},t.prototype.clearSelection=function t(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()},t.prototype.destroy=function t(){this.removeFake()},a(t,[{key:"action",set:function t(){var e=arguments.length<=0||void 0===arguments[0]?"copy":arguments[0];if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function t(){return this._action}},{key:"target",set:function t(e){if(void 0!==e){if(!e||"object"!==("undefined"==typeof e?"undefined":r(e))||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function t(){return this._target}}]),t}();t.exports=c})},{select:6}],9:[function(e,n,o){!function(i,r){if("function"==typeof t&&t.amd)t(["module","./clipboard-action","tiny-emitter","good-listener"],r);else if("undefined"!=typeof o)r(n,e("./clipboard-action"),e("tiny-emitter"),e("good-listener"));else{var a={exports:{}};r(a,i.clipboardAction,i.tinyEmitter,i.goodListener),i.clipboard=a.exports}}(this,function(t,e,n,o){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){var n="data-clipboard-"+t;if(e.hasAttribute(n))return e.getAttribute(n)}var l=i(e),u=i(n),f=i(o),d=function(t){function e(n,o){r(this,e);var i=a(this,t.call(this));return i.resolveOptions(o),i.listenClick(n),i}return c(e,t),e.prototype.resolveOptions=function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText},e.prototype.listenClick=function t(e){var n=this;this.listener=(0,f.default)(e,"click",function(t){return n.onClick(t)})},e.prototype.onClick=function t(e){var n=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new l.default({action:this.action(n),target:this.target(n),text:this.text(n),trigger:n,emitter:this})},e.prototype.defaultAction=function t(e){return s("action",e)},e.prototype.defaultTarget=function t(e){var n=s("target",e);return n?document.querySelector(n):void 0},e.prototype.defaultText=function t(e){return s("text",e)},e.prototype.destroy=function t(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)},e}(u.default);t.exports=d})},{"./clipboard-action":8,"good-listener":4,"tiny-emitter":7}]},{},[9])(9)});